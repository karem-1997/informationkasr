<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø¹ÙŠÙ†ÙŠ Ø§Ù„ÙØ±Ù†Ø³Ø§ÙˆÙŠ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <style>
        :root { --primary: #1a5276; --secondary: #2980b9; --success: #27ae60; --danger: #c0392b; --accent: #f39c12; --bg: #d5d8dc; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--bg); margin: 0; padding: 10px; padding-bottom: 110px; direction: rtl; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); min-height: 85vh; }
        header { text-align: center; margin-bottom: 20px; border-bottom: 3px solid var(--secondary); padding-bottom: 10px; }
        h1 { color: var(--primary); font-size: 1.2rem; margin: 0; }
        
        .fb-float { position: fixed; bottom: 85px; left: 20px; background: #1877f2; color: white; width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000; text-decoration: none; border: 2px solid #fff; }

        .admin-panel { display: none; background: #e8f6f3; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 2px dashed var(--success); }
        input { padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-family: 'Tajawal'; width: 100%; box-sizing: border-box; margin-bottom: 8px; font-size: 1rem; }
        
        .list-menu { display: flex; flex-direction: column; gap: 12px; }
        .item-link { position: relative; background: var(--secondary); border-radius: 12px; cursor: pointer; transition: 0.1s; display: block; width: 100%; border: none; padding: 0; }
        .item-link:active { background: var(--primary); transform: scale(0.98); }
        .clickable-area { display: block; padding: 18px; color: white; text-align: center; font-weight: bold; font-size: 1.1rem; text-decoration: none; }
        
        .btn-del-item { position: absolute; top: 5px; left: 5px; background: white; color: red; border: 2px solid red; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; display: none; font-weight: bold; z-index: 100; }

        .data-card { background: #fff; border: 1px solid #ddd; border-radius: 12px; padding: 15px; margin-bottom: 15px; border-right: 6px solid var(--accent); position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .data-row { display: flex; flex-direction: column; gap: 4px; margin-bottom: 8px; }
        .data-label { font-size: 0.8rem; color: #7f8c8d; font-weight: bold; }
        .data-value { font-size: 1.05rem; color: var(--primary); font-weight: bold; }
        
        .btn-wa { background: #25d366; color: white; padding: 10px; border-radius: 8px; text-align: center; text-decoration: none; font-weight: bold; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 5px; margin-top: 10px; }
        .badge-price { background: #eafaf1; color: var(--success); padding: 5px 12px; border-radius: 15px; font-weight: bold; border: 1px solid var(--success); display: inline-block; }

        .admin-trigger-btn { background: transparent; color: #aaa; margin-top: 30px; font-size: 0.8rem; width: 100%; border: none; text-decoration: underline; cursor: pointer; text-align: center; padding: 10px; display: block; }
        .footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; padding: 12px; border-top: 2px solid #ddd; display: flex; justify-content: center; z-index: 999; }
        .btn-back-main { background: var(--primary); color: white; width: 90%; max-width: 460px; padding: 14px; border-radius: 10px; text-align: center; font-weight: bold; cursor: pointer; border: none; font-size: 1rem; }
        
        .screen { display: none; } .active { display: block; }
    </style>
</head>
<body>

<div class="container">
    <header><h1>Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø¹ÙŠÙ†ÙŠ Ø§Ù„ÙØ±Ù†Ø³Ø§ÙˆÙŠ</h1></header>
    <a id="h-fb-link" href="#" target="_blank" class="fb-float"><i class="fab fa-facebook-f"></i></a>

    <div id="screen-main" class="screen active">
        <div id="panel-main" class="admin-panel">
            <b>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</b>
            <input type="text" id="h-fb-input" placeholder="Ø±Ø§Ø¨Ø· ÙÙŠØ³Ø¨ÙˆÙƒ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰">
            <input type="text" id="new-cat-name" placeholder="Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ Ø¬Ø¯ÙŠØ¯">
            <button onclick="saveMainSettings()" style="background:var(--success); color:white; width:100%; padding:12px; border:none; border-radius:8px;">Ø­ÙØ¸ ÙˆØ¥Ø¶Ø§ÙØ©</button>
        </div>
        <div class="list-menu" id="cats-list"></div>
        <button class="admin-trigger-btn" onclick="unlockAdmin()">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</button>
    </div>

    <div id="screen-depts" class="screen">
        <h2 id="cat-title" style="text-align:center;"></h2>
        <div id="panel-depts" class="admin-panel">
            <input type="text" id="dept-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…">
            <input type="text" id="dept-wa" placeholder="ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù‚Ø³Ù…">
            <button onclick="addDept()" style="background:var(--success); color:white; width:100%; padding:12px; border:none; border-radius:8px;">Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù…</button>
        </div>
        <div class="list-menu" id="depts-list"></div>
        <button class="admin-trigger-btn" onclick="unlockAdmin()">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
    </div>

    <div id="screen-options" class="screen">
        <h2 id="opt-dept-title" style="text-align:center;"></h2>
        <div id="dept-wa-area" style="margin-bottom:15px;"></div>
        <div class="list-menu">
            <div class="item-link" onclick="showScreen('screen-days')"><span class="clickable-area">ğŸ“… Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</span></div>
            <div class="item-link" style="background:var(--accent)" onclick="showScreen('screen-services')"><span class="clickable-area">ğŸ’° Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±</span></div>
        </div>
    </div>

    <div id="screen-days" class="screen">
        <h2 style="text-align:center;">Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ…</h2>
        <div class="list-menu" id="days-list"></div>
    </div>

    <div id="screen-clinics" class="screen">
        <h3 id="clinic-day-title" style="text-align:center;"></h3>
        <div id="panel-clinics" class="admin-panel">
            <input type="text" id="c-name" placeholder="Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©">
            <input type="text" id="c-doc" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±">
            <input type="text" id="c-time" placeholder="Ø§Ù„Ù…ÙˆØ¹Ø¯">
            <input type="number" id="c-price" placeholder="Ø§Ù„Ø³Ø¹Ø±">
            <input type="text" id="c-wa" placeholder="ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¯ÙƒØªÙˆØ±">
            <button onclick="saveClinic()" style="background:var(--success); color:white; width:100%; padding:12px; border:none; border-radius:8px;">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯</button>
        </div>
        <div id="clinics-list"></div>
        <button class="admin-trigger-btn" onclick="unlockAdmin()">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</button>
    </div>

    <div id="screen-services" class="screen">
        <h2 style="text-align:center;">Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª</h2>
        <div id="panel-services" class="admin-panel">
            <input type="text" id="s-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø®Ø¯Ù…Ø©">
            <input type="number" id="s-price" placeholder="Ø§Ù„Ø³Ø¹Ø±">
            <button onclick="addService()" style="background:var(--success); color:white; width:100%; padding:12px; border:none; border-radius:8px;">Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø©</button>
        </div>
        <div id="services-list"></div>
        <button class="admin-trigger-btn" onclick="unlockAdmin()">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª</button>
    </div>

    <div class="footer-nav" id="master-footer" style="display:none;">
        <button class="btn-back-main" id="back-btn">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDYW77Gt98QizE_x4o9qM_3PIRtZK1xRXw",
        authDomain: "informationkasr-d7f90.firebaseapp.com",
        projectId: "informationkasr-d7f90",
        storageBucket: "informationkasr-d7f90.firebasestorage.app",
        messagingSenderId: "183077060452",
        appId: "1:183077060452:web:647171df9af42d537e4471",
        measurementId: "G-8PR2NHX5C3"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const DAYS = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"];
    
    let state = { fb: "#", cats: [] };
    let cur = { cat: null, dept: null, day: null };
    let isAdmin = false;

    async function load() {
        const doc = await db.collection("app").doc("data").get();
        if(doc.exists) { state = doc.data(); renderAll(); }
    }

    async function sync() {
        await db.collection("app").doc("data").set(state);
        renderAll();
    }

    function unlockAdmin() {
        if(isAdmin || prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± (Ali):") === "Ali") {
            isAdmin = true;
            document.querySelectorAll('.admin-panel').forEach(p => p.style.display = 'block');
            document.querySelectorAll('.btn-del-item').forEach(b => b.style.display = 'block');
            renderAll();
        }
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('master-footer').style.display = (id === 'screen-main') ? 'none' : 'flex';
        const routes = { 'screen-depts':'screen-main', 'screen-options':'screen-depts', 'screen-days':'screen-options', 'screen-clinics':'screen-days', 'screen-services':'screen-options' };
        document.getElementById('back-btn').onclick = () => showScreen(routes[id]);
        if(id === 'screen-days') renderDays();
        if(id === 'screen-clinics') renderClinics();
        if(id === 'screen-services') renderServices();
        window.scrollTo(0,0);
    }

    function saveMainSettings() {
        state.fb = document.getElementById('h-fb-input').value || state.fb;
        let n = document.getElementById('new-cat-name').value.trim();
        if(n) { state.cats.push({ name: n, depts: [] }); document.getElementById('new-cat-name').value=''; }
        sync();
    }

    function renderMain() {
        const div = document.getElementById('cats-list'); div.innerHTML = "";
        state.cats.forEach((c, i) => {
            div.innerHTML += `<div class="item-link" onclick="openCat(${i})"><span class="clickable-area">${c.name}</span><button class="btn-del-item" onclick="event.stopPropagation(); state.cats.splice(${i},1); sync();" style="display:${isAdmin?'block':'none'}">X</button></div>`;
        });
        document.getElementById('h-fb-link').href = state.fb;
    }

    function openCat(i) { cur.cat = i; document.getElementById('cat-title').innerText = state.cats[i].name; showScreen('screen-depts'); renderDepts(); }

    function addDept() {
        let n = document.getElementById('dept-name').value.trim();
        let w = document.getElementById('dept-wa').value.trim();
        if(n) { 
            if(!state.cats[cur.cat].depts) state.cats[cur.cat].depts = [];
            state.cats[cur.cat].depts.push({ name: n, wa: w, clinics: {}, services: [] }); 
            document.getElementById('dept-name').value=''; document.getElementById('dept-wa').value='';
            sync(); 
        }
    }

    function renderDepts() {
        const div = document.getElementById('depts-list'); div.innerHTML = "";
        const depts = state.cats[cur.cat].depts || [];
        depts.forEach((d, i) => {
            div.innerHTML += `<div class="item-link" onclick="openDept(${i})"><span class="clickable-area">${d.name}</span><button class="btn-del-item" onclick="event.stopPropagation(); state.cats[cur.cat].depts.splice(${i},1); sync();" style="display:${isAdmin?'block':'none'}">X</button></div>`;
        });
    }

    function openDept(i) { 
        cur.dept = i; 
        const d = state.cats[cur.cat].depts[i];
        document.getElementById('opt-dept-title').innerText = d.name;
        document.getElementById('dept-wa-area').innerHTML = d.wa ? `<a href="https://wa.me/${d.wa}" class="btn-wa"><i class="fab fa-whatsapp"></i> ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</a>` : "";
        showScreen('screen-options'); 
    }

    function renderDays() {
        const div = document.getElementById('days-list'); div.innerHTML = "";
        DAYS.forEach(d => div.innerHTML += `<div class="item-link" style="background:#5d6d7e" onclick="cur.day='${d}'; showScreen('screen-clinics')"><span class="clickable-area">${d}</span></div>`);
    }

    function saveClinic() {
        const d = state.cats[cur.cat].depts[cur.dept];
        if(!d.clinics) d.clinics = {};
        if(!d.clinics[cur.day]) d.clinics[cur.day] = [];
        d.clinics[cur.day].push({ name: document.getElementById('c-name').value, doc: document.getElementById('c-doc').value, time: document.getElementById('c-time').value, price: document.getElementById('c-price').value, wa: document.getElementById('c-wa').value });
        document.getElementById('c-name').value=''; document.getElementById('c-doc').value=''; document.getElementById('c-time').value=''; document.getElementById('c-price').value=''; document.getElementById('c-wa').value='';
        sync();
    }

    function renderClinics() {
        document.getElementById('clinic-day-title').innerText = "Ù…ÙˆØ§Ø¹ÙŠØ¯ " + cur.day;
        const div = document.getElementById('clinics-list'); div.innerHTML = "";
        const d = state.cats[cur.cat].depts[cur.dept];
        const list = (d.clinics && d.clinics[cur.day]) ? d.clinics[cur.day] : [];
        list.forEach((c, i) => {
            div.innerHTML += `<div class="data-card">
                <div class="data-row"><span class="data-label">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:</span><span class="data-value">${c.name}</span></div>
                <div class="data-row"><span class="data-label">Ø§Ù„Ø¯ÙƒØªÙˆØ±:</span><span class="data-value">Ø¯. ${c.doc}</span></div>
                <div class="data-row"><span class="data-label">Ø§Ù„Ù…ÙˆØ¹Ø¯:</span><span class="data-value">${c.time}</span></div>
                <div class="badge-price">${c.price} Ø¬.Ù…</div>
                ${c.wa ? `<a href="https://wa.me/${c.wa}" class="btn-wa"><i class="fab fa-whatsapp"></i> ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</a>` : ""}
                <button class="btn-del-item" onclick="state.cats[cur.cat].depts[cur.dept].clinics[cur.day].splice(${i},1); sync();" style="display:${isAdmin?'block':'none'}">X</button>
            </div>`;
        });
    }

    function addService() {
        const d = state.cats[cur.cat].depts[cur.dept];
        if(!d.services) d.services = [];
        d.services.push({ name: document.getElementById('s-name').value, price: document.getElementById('s-price').value });
        document.getElementById('s-name').value=''; document.getElementById('s-price').value='';
        sync();
    }

    function renderServices() {
        const div = document.getElementById('services-list'); div.innerHTML = "";
        const d = state.cats[cur.cat].depts[cur.dept];
        const list = d.services || [];
        list.forEach((s, i) => {
            div.innerHTML += `<div class="data-card">
                <div class="data-row"><span class="data-label">Ø§Ù„Ø®Ø¯Ù…Ø©:</span><span class="data-value">${s.name}</span></div>
                <div class="badge-price">${s.price} Ø¬.Ù…</div>
                <button class="btn-del-item" onclick="state.cats[cur.cat].depts[cur.dept].services.splice(${i},1); sync();" style="display:${isAdmin?'block':'none'}">X</button>
            </div>`;
        });
    }

    function renderAll() { renderMain(); if(cur.cat!==null) renderDepts(); if(cur.day) renderClinics(); if(cur.cat!==null&&cur.dept!==null) renderServices(); }
    load();
</script>
</body>
</html>
